{"version":3,"sources":["../../src/bin/commander.js"],"names":["_","require","program","codeAction","checkWrapAction","refsAction","cliPrinter","COMMAND_INDENT","Array","join","module","exports","version","command","description","option","argsToArray","action","input","output","args","options","key2key","isPartialUpdate","f","color","colors","enabled","obj","codeModifyItems","t","TranslateWord","T","e","TranslateWord_RegExp","E","a","I18NHandlerAlias","A","catch","err","console","log","stack","string","cmd","self","findSubCommand","parent","Error","outputHelp","info","replace","name","commands","some","item","alias","keyMap","result","each","val","key","split","map","trim","filter"],"mappings":"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","sourcesContent":["'use strict';\n\nconst _\t\t\t\t= require('lodash');\nconst program         = require('commander');\nconst codeAction      = require('./actions/code');\nconst checkWrapAction = require('./actions/check-wrap');\nconst refsAction      = require('./actions/refs');\nconst cliPrinter      = require('../util/cli_printer');\n\nconst COMMAND_INDENT = '\\n'+new Array(42).join(' ');\nmodule.exports = program;\n\nprogram.version(\n\t\t' cli: v'+require('../package.json').version\n\t\t+ '\\ncore: v'+require('../').version\n\t);\n\nprogram.command('code <input> <output>')\n\t.description('Warp code width I18N handler.')\n\t.option('-d --input-po-dir [dir]', 'Input po files dir')\n\t.option('   --input-po-file [file]', 'Input po files file')\n\t.option('   --translate-db-file [file]', 'Translate data db file')\n\t.option('-o --output-po-dir [dir]', 'Output po files dir')\n\t.option('   --output-word-file [file]', 'Output translate words')\n\t.option('-l --lans [lan1,lan2]', 'Pick file languages', argsToArray)\n\t.option('-n --i18n-handler-name [name]', 'Custom I18N handler name')\n\t.option('   --i18n-handler-alias [name,name]', 'I18N handler alias', argsToArray)\n\t.option('   --ignore-scan-names [name,name]', 'Ignore cacn handler names', argsToArray)\n\n\t.option('   --only-check', 'Only check, not write code to file')\n\t.option('-r', 'Recurse into directories')\n\t.option('-w', 'Closure when I18N hanlder insert head')\n\t.option('-m', 'Min Function translate code of I18N handler')\n\t.option('-f', ['Force update total I18N Function', 'default: partial update'].join(COMMAND_INDENT)+'\\n')\n\n\t.option('-c, --color', 'Enable colored output')\n\t.option('-C, --no-color', 'Disable colored output')\n\n\t.option('-t', 'Enable codeModifyItems: TranslateWord')\n\t.option('-T', 'Disable codeModifyItems: TranslateWord')\n\t.option('-e', 'Enable codeModifyItems: TranslateWord_RegExp')\n\t.option('-E', 'Disable codeModifyItems: TranslateWord_RegExp')\n\t.option('-a', 'Enable codeModifyItems: I18NHandlerAlias')\n\t.option('-A', 'Disable codeModifyItems: I18NHandlerAlias')\n\t.action(function(input, output, args)\n\t{\n\t\tlet options = key2key(args,\n\t\t\t{\n\t\t\t\t'input-po-dir'       : 'inputPODir',\n\t\t\t\t'input-po-file'      : 'inputPOFile',\n\t\t\t\t'translate-db-file'  : 'translateDBFile',\n\t\t\t\t'output-po-dir'      : 'outputPODir',\n\t\t\t\t'output-word-file'   : 'outputWordFile',\n\t\t\t\t'lans'               : 'onlyTheseLanguages',\n\t\t\t\t'i18n-hanlder-name'  : 'I18NHandlerName',\n\t\t\t\t'i18n-hanlder-alias' : 'I18NHandlerAlias',\n\t\t\t\t'ignore-scan-names'  : 'ignoreScanHandlerNames',\n\t\t\t\t'only-check'         : 'isOnlyCheck',\n\t\t\t\t'r'                  : 'isRecurse',\n\t\t\t\t'c'                  : 'isCheckClosureForNewI18NHandler',\n\t\t\t\t'm'                  : 'minTranslateFuncCode',\n\t\t\t});\n\n\t\toptions.isPartialUpdate = !args.f;\n\n\t\tif (args.color === false) cliPrinter.colors.enabled = false;\n\n\t\tlet obj = options.codeModifyItems = {};\n\t\tif (args.t) obj.TranslateWord = true;\n\t\tif (args.T) obj.TranslateWord = false;\n\t\tif (args.e) obj.TranslateWord_RegExp = true;\n\t\tif (args.E) obj.TranslateWord_RegExp = false;\n\t\tif (args.a) obj.I18NHandlerAlias = true;\n\t\tif (args.A) obj.I18NHandlerAlias = false;\n\n\t\tcodeAction(input, output, options)\n\t\t\t.catch(function(err)\n\t\t\t{\n\t\t\t\tconsole.log(err.stack);\n\t\t\t});\n\t});\n\n\nprogram.command('check-wrap <input>')\n\t.description('Check if all words were wrapped by I18N handler.')\n\t.option('-n --i18n-handler-name [name]', 'Custom I18N handler name')\n\t.option('   --i18n-handler-alias [name,name]', 'I18N handler alias', argsToArray)\n\t.option('   --ignore-scan-names [name,name]', 'Ignore cacn handler names', argsToArray)\n\n\t.option('-r', 'Recurse into directories')\n\n\t.option('-c, --color', 'Enable colored output')\n\t.option('-C, --no-color', 'Disable colored output')\n\n\t.option('-t', 'Enable codeModifyItems: TranslateWord')\n\t.option('-T', 'Disable codeModifyItems: TranslateWord')\n\t.option('-e', 'Enable codeModifyItems: TranslateWord_RegExp')\n\t.option('-E', 'Disable codeModifyItems: TranslateWord_RegExp')\n\t.option('-a', 'Enable codeModifyItems: I18NHandlerAlias')\n\t.option('-A', 'Disable codeModifyItems: I18NHandlerAlias')\n\t.action(function(input, args)\n\t{\n\t\tlet options = key2key(args,\n\t\t\t{\n\t\t\t\t'i18n-handler-name'  : 'I18NHandlerName',\n\t\t\t\t'i18n-hanlder-alias' : 'I18NHandlerAlias',\n\t\t\t\t'ignore-scan-names'  : 'ignoreScanHandlerNames',\n\t\t\t\t'r'                  : 'isRecurse',\n\t\t\t});\n\n\t\tif (args.color === false) cliPrinter.colors.enabled = false;\n\n\t\tlet obj = options.codeModifyItems = {};\n\t\tif (args.t) obj.TranslateWord = true;\n\t\tif (args.T) obj.TranslateWord = false;\n\t\tif (args.e) obj.TranslateWord_RegExp = true;\n\t\tif (args.E) obj.TranslateWord_RegExp = false;\n\t\tif (args.a) obj.I18NHandlerAlias = true;\n\t\tif (args.A) obj.I18NHandlerAlias = false;\n\n\t\tcheckWrapAction(input, options)\n\t\t\t.catch(function(err)\n\t\t\t{\n\t\t\t\tconsole.log(err.stack);\n\t\t\t});\n\t});\n\n\nprogram.command('refs <string>')\n\t.description('Parse refs in po files. <e.g.> \"1,1,0,7,subtype,*\"')\n\t.option('-C, --no-color', 'Disable colored output.')\n\t.action(function(string, args)\n\t{\n\t\tif (args.color === false) cliPrinter.colors.enabled = false;\n\n\t\ttry {\n\t\t\trefsAction(string);\n\t\t}\n\t\tcatch(err)\n\t\t{\n\t\t\tconsole.log(err.stack);\n\t\t}\n\t});\n\nprogram.command('help <cmd>')\n\t.description('display help for [cmd]')\n\t.action(function(cmd)\n\t{\n\t\tlet self = this;\n\n\t\tlet command = findSubCommand(self.parent, cmd);\n\t\tif (!command) throw new Error('No Defined Command, '+cmd);\n\n\t\t// command.help();\n\t\t// remove help info\n\t\tcommand.outputHelp(function(info)\n\t\t{\n\t\t\treturn info\n\t\t\t\t// 删除Options下的help\n\t\t\t\t.replace(/ +-h, --help [^\\n]+\\n/, '')\n\t\t\t\t// 在命令行前加上父节点前缀\n\t\t\t\t.replace(/Usage: */, 'Usage: '+self.parent.name()+' ')\n\t\t\t\t// 如果没有多余的Options，就把这一项干掉\n\t\t\t\t.replace(/ +Options:\\s+$/, '')\n\t\t\t\t+ '\\n';\n\t\t});\n\t});\n\n\n// find sub command\nfunction findSubCommand(program, cmd)\n{\n\tlet command;\n\tprogram.commands.some(function(item)\n\t{\n\t\tif (item.name() == cmd || item.alias() == cmd)\n\t\t{\n\t\t\tcommand = item;\n\t\t\treturn true;\n\t\t}\n\t});\n\n\treturn command;\n}\n\nfunction key2key(obj, keyMap)\n{\n\tlet result = {};\n\t_.each(obj, function(val, key)\n\t{\n\t\treturn result[keyMap[key] || key] = val;\n\t});\n\treturn result;\n}\n\nfunction argsToArray(val)\n{\n\treturn val.split(',')\n\t\t.map(function(val){return val.trim()})\n\t\t.filter(function(val){return val});\n}\n"],"file":"commander.js"}