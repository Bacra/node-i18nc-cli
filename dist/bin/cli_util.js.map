{"version":3,"sources":["../../src/bin/cli_util.js"],"names":["debug","require","Promise","fs","promisifyAll","glob","promisify","mkdirp","path","i18nc","stripBOM","exports","scanFileList","input","recurse","statAsync","then","stats","isFile","realpathAsync","file","type","data","isDirectory","Error","cwd","nodir","realpath","files","err","code","indexOf","getWriteOneFilePath","output","filename","basename","tailStr","length","dir","rfile","join","file2i18nc","options","readFileAsync","encoding"],"mappings":"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","sourcesContent":["'use strict';\n\nconst debug    = require('debug')('i18nc:cli_util');\nconst Promise  = require('bluebird');\nconst fs       = Promise.promisifyAll(require('fs'));\nconst glob     = Promise.promisify(require('glob'));\nconst mkdirp   = Promise.promisify(require('mkdirp'));\nconst path     = require('path');\nconst i18nc    = require('i18nc-core');\nconst stripBOM = require('strip-bom');\n\nexports.scanFileList = scanFileList;\nfunction scanFileList(input, recurse)\n{\n\treturn fs.statAsync(input)\n\t\t.then(function(stats)\n\t\t{\n\t\t\tif (stats.isFile())\n\t\t\t{\n\t\t\t\tdebug('input is file');\n\t\t\t\treturn fs.realpathAsync(input)\n\t\t\t\t\t.then(function(file)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: 'one',\n\t\t\t\t\t\t\tdata: file\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse if (stats.isDirectory())\n\t\t\t{\n\t\t\t\tdebug('input is dir');\n\t\t\t\tif (!recurse) throw new Error('Input Is A Directory');\n\n\t\t\t\treturn glob('**/*', {cwd: input, nodir: true, realpath: true})\n\t\t\t\t\t.then(function(files)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: 'list',\n\t\t\t\t\t\t\tdata: files\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthrow new Error('Input Is Not File Or Directory');\n\t\t\t}\n\t\t},\n\t\tfunction(err)\n\t\t{\n\t\t\tif (!err || !err.code == 'ENOENT') throw err;\n\t\t\tif (!recurse && input.indexOf('*') == -1) throw err;\n\n\t\t\tdebug('input is not exists, start glob');\n\n\t\t\treturn glob(input, {nodir: true, realpath: true})\n\t\t\t\t.then(function(files)\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: 'list',\n\t\t\t\t\t\tdata: files\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t});\n}\n\n/**\n * 写入一个文件，需要判断input本身的文件状态\n */\nexports.getWriteOneFilePath = getWriteOneFilePath;\nfunction getWriteOneFilePath(output, input)\n{\n\treturn fs.statAsync(output)\n\t\t.then(function(stats)\n\t\t{\n\t\t\tif (stats.isFile())\n\t\t\t{\n\t\t\t\tdebug('output is file');\n\t\t\t\treturn output;\n\t\t\t}\n\t\t\telse if (stats.isDirectory())\n\t\t\t{\n\t\t\t\tdebug('output is dir');\n\t\t\t\tlet filename = path.basename(input);\n\t\t\t\treturn output+'/'+filename;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthrow new Error('Input Is Not File Or Directory');\n\t\t\t}\n\t\t},\n\t\tfunction(err)\n\t\t{\n\t\t\tif (!err || err.code != 'ENOENT') throw err;\n\n\t\t\tdebug('output is not exists');\n\t\t\t// 当文件不存在的时候\n\t\t\tlet tailStr = output[output.length-1];\n\t\t\tlet dir, rfile;\n\t\t\tif (tailStr == '/' || tailStr == '\\\\')\n\t\t\t{\n\t\t\t\tdebug('ouput maybe is path');\n\t\t\t\tdir = output;\n\t\t\t\trfile = dir + path.basename(input);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdir = path.join(output, '..');\n\t\t\t\trfile = output;\n\t\t\t}\n\n\t\t\treturn mkdirp(dir)\n\t\t\t\t.then(function()\n\t\t\t\t{\n\t\t\t\t\treturn rfile;\n\t\t\t\t});\n\t\t});\n}\n\n\nexports.file2i18nc = file2i18nc;\nfunction file2i18nc(file, options)\n{\n\treturn fs.readFileAsync(file,\n\t\t{\n\t\t\tencoding: 'utf8'\n\t\t})\n\t\t.then(function(code)\n\t\t{\n\t\t\tcode = stripBOM(code);\n\t\t\treturn i18nc(code, options);\n\t\t});\n}\n"],"file":"cli_util.js"}