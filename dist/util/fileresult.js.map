{"version":3,"sources":["../../src/util/fileresult.js"],"names":["Promise","require","_","fs","promisifyAll","mkdirp","promisify","debug","i18ncPO","exports","mulitResult2POFiles","data","outputDir","options","subScopeDatas","values","length","CodeInfoResult","constructor","result","output","create","title","poFileTitle","email","poFileEmail","existedTranslateFilter","onlyTheseLanguages","I18NHandler","poPromises","map","keys","po","lan","file","writeFileAsync","concurrency","all","pot"],"mappings":"AAAA;;;;;;;;AAEA,IAAMA,OAAO,GAAGC,OAAO,CAAC,UAAD,CAAvB;;AACA,IAAMC,CAAC,GAASD,OAAO,CAAC,QAAD,CAAvB;;AACA,IAAME,EAAE,GAAQH,OAAO,CAACI,YAAR,CAAqBH,OAAO,CAAC,IAAD,CAA5B,CAAhB;AACA,IAAMI,MAAM,GAAIL,OAAO,CAACM,SAAR,CAAkBL,OAAO,CAAC,QAAD,CAAzB,CAAhB;;AACA,IAAMM,KAAK,GAAKN,OAAO,CAAC,OAAD,CAAP,CAAiB,kBAAjB,CAAhB;;AACA,IAAMO,OAAO,GAAGP,OAAO,CAAC,UAAD,CAAvB;;AAGAQ,OAAO,CAACC,mBAAR,GAA8BA,mBAA9B;AAEA;;;;;SAIeA,mB;;;;;;;4BAAf,iBAAmCC,IAAnC,EAAyCC,SAAzC,EAAoDC,OAApD;AAAA;AAAA;AAAA;AAAA;AAAA;AAEC,gBAAI,CAACA,OAAL,EAAcA,OAAO,GAAG,EAAV;AACVC,YAAAA,aAHL,GAGqBZ,CAAC,CAACa,MAAF,CAASJ,IAAT,CAHrB;;AAAA,kBAIK,CAACG,aAAD,IAAkB,CAACA,aAAa,CAACE,MAJtC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAMKC,YAAAA,cANL,GAMsBH,aAAa,CAAC,CAAD,CAAb,CAAiBI,WANvC;AAOKC,YAAAA,MAPL,GAOc,IAAIF,cAAJ,CAAmB;AAACH,cAAAA,aAAa,EAAEA;AAAhB,aAAnB,CAPd;AAQKM,YAAAA,MARL,GAQcZ,OAAO,CAACa,MAAR,CAAeF,MAAf,EACZ;AACCG,cAAAA,KAAK,EAAET,OAAO,CAACU,WADhB;AAECC,cAAAA,KAAK,EAAEX,OAAO,CAACY,WAFhB;AAGCC,cAAAA,sBAAsB,EAAEb,OAAO,CAACa,sBAHjC;AAICC,cAAAA,kBAAkB,EAAEd,OAAO,CAACe,WAAR,IAChBf,OAAO,CAACe,WAAR,CAAoBjB,IADJ,IAEhBE,OAAO,CAACe,WAAR,CAAoBjB,IAApB,CAAyBgB;AAN9B,aADY,CARd;AAiBCpB,YAAAA,KAAK,CAAC,WAAD,EAAca,MAAd,CAAL;AAjBD;AAAA,mBAmBOf,MAAM,CAACO,SAAD,CAnBb;;AAAA;AAqBKiB,YAAAA,UArBL,GAqBkB7B,OAAO,CAAC8B,GAAR,CAAY5B,CAAC,CAAC6B,IAAF,CAAOX,MAAM,CAACY,EAAd,CAAZ,EAA+B,UAASC,GAAT,EAC/C;AACC,kBAAIC,IAAI,GAAGtB,SAAS,GAAC,GAAV,GAAcqB,GAAd,GAAkB,KAA7B;AACA,qBAAO9B,EAAE,CAACgC,cAAH,CAAkBD,IAAlB,EAAwBd,MAAM,CAACY,EAAP,CAAUC,GAAV,CAAxB,CAAP;AACA,aAJe,EAKhB;AACCG,cAAAA,WAAW,EAAE;AADd,aALgB,CArBlB;AAAA,6CA8BQpC,OAAO,CAACqC,GAAR,CACN,CACClC,EAAE,CAACgC,cAAH,CAAkBvB,SAAS,GAAC,WAA5B,EAAyCQ,MAAM,CAACkB,GAAhD,CADD,EAECT,UAFD,CADM,CA9BR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["'use strict';\n\nconst Promise = require('bluebird');\nconst _       = require('lodash');\nconst fs      = Promise.promisifyAll(require('fs'));\nconst mkdirp  = Promise.promisify(require('mkdirp'));\nconst debug   = require('debug')('i18nc:fileresult');\nconst i18ncPO = require('i18nc-po');\n\n\nexports.mulitResult2POFiles = mulitResult2POFiles;\n\n/**\n * 将很多个文件解析的结果，打包成一组po文件\n * data的格式为 {filepath: <i18nc ret>}\n */\nasync function mulitResult2POFiles(data, outputDir, options)\n{\n\tif (!options) options = {};\n\tlet subScopeDatas = _.values(data);\n\tif (!subScopeDatas || !subScopeDatas.length) return;\n\n\tlet CodeInfoResult = subScopeDatas[0].constructor;\n\tlet result = new CodeInfoResult({subScopeDatas: subScopeDatas});\n\tlet output = i18ncPO.create(result,\n\t\t{\n\t\t\ttitle: options.poFileTitle,\n\t\t\temail: options.poFileEmail,\n\t\t\texistedTranslateFilter: options.existedTranslateFilter,\n\t\t\tonlyTheseLanguages: options.I18NHandler\n\t\t\t\t&& options.I18NHandler.data\n\t\t\t\t&& options.I18NHandler.data.onlyTheseLanguages,\n\t\t});\n\tdebug('output:%o', output);\n\n\tawait mkdirp(outputDir);\n\n\tlet poPromises = Promise.map(_.keys(output.po), function(lan)\n\t\t{\n\t\t\tlet file = outputDir+'/'+lan+'.po';\n\t\t\treturn fs.writeFileAsync(file, output.po[lan]);\n\t\t},\n\t\t{\n\t\t\tconcurrency: 5\n\t\t});\n\n\treturn Promise.all(\n\t\t[\n\t\t\tfs.writeFileAsync(outputDir+'/lans.pot', output.pot),\n\t\t\tpoPromises\n\t\t]);\n}\n"],"file":"fileresult.js"}