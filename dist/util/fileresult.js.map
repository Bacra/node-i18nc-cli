{"version":3,"sources":["../../src/util/fileresult.js"],"names":["Promise","require","_","fs","promisifyAll","mkdirp","promisify","debug","i18ncPO","exports","mulitResult2POFiles","data","outputDir","options","subScopeDatas","values","length","resolve","CodeInfoResult","constructor","result","output","create","title","poFileTitle","email","poFileEmail","existedTranslateFilter","onlyTheseLanguages","I18NHandler","then","poPromises","map","keys","po","lan","file","writeFileAsync","concurrency","all","pot"],"mappings":"AAAA;;AAEA,IAAMA,OAAO,GAAGC,OAAO,CAAC,UAAD,CAAvB;;AACA,IAAMC,CAAC,GAASD,OAAO,CAAC,QAAD,CAAvB;;AACA,IAAME,EAAE,GAAQH,OAAO,CAACI,YAAR,CAAqBH,OAAO,CAAC,IAAD,CAA5B,CAAhB;AACA,IAAMI,MAAM,GAAIL,OAAO,CAACM,SAAR,CAAkBL,OAAO,CAAC,QAAD,CAAzB,CAAhB;;AACA,IAAMM,KAAK,GAAKN,OAAO,CAAC,OAAD,CAAP,CAAiB,kBAAjB,CAAhB;;AACA,IAAMO,OAAO,GAAGP,OAAO,CAAC,UAAD,CAAvB;;AAGAQ,OAAO,CAACC,mBAAR,GAA8BA,mBAA9B;AAEA;;;;;AAIA,SAASA,mBAAT,CAA6BC,IAA7B,EAAmCC,SAAnC,EAA8CC,OAA9C,EACA;AACC,MAAI,CAACA,OAAL,EAAcA,OAAO,GAAG,EAAV;;AACd,MAAIC,aAAa,GAAGZ,CAAC,CAACa,MAAF,CAASJ,IAAT,CAApB;;AACA,MAAI,CAACG,aAAD,IAAkB,CAACA,aAAa,CAACE,MAArC,EACA;AACC,WAAOhB,OAAO,CAACiB,OAAR,EAAP;AACA;;AACD,MAAIC,cAAc,GAAGJ,aAAa,CAAC,CAAD,CAAb,CAAiBK,WAAtC;AACA,MAAIC,MAAM,GAAG,IAAIF,cAAJ,CAAmB;AAACJ,IAAAA,aAAa,EAAEA;AAAhB,GAAnB,CAAb;AACA,MAAIO,MAAM,GAAGb,OAAO,CAACc,MAAR,CAAeF,MAAf,EACZ;AACCG,IAAAA,KAAK,EAAEV,OAAO,CAACW,WADhB;AAECC,IAAAA,KAAK,EAAEZ,OAAO,CAACa,WAFhB;AAGCC,IAAAA,sBAAsB,EAAEd,OAAO,CAACc,sBAHjC;AAICC,IAAAA,kBAAkB,EAAEf,OAAO,CAACgB,WAAR,IAChBhB,OAAO,CAACgB,WAAR,CAAoBlB,IADJ,IAEhBE,OAAO,CAACgB,WAAR,CAAoBlB,IAApB,CAAyBiB;AAN9B,GADY,CAAb;AASArB,EAAAA,KAAK,CAAC,WAAD,EAAcc,MAAd,CAAL;AAEA,SAAOhB,MAAM,CAACO,SAAD,CAAN,CACLkB,IADK,CACA,YACN;AACC,QAAIC,UAAU,GAAG/B,OAAO,CAACgC,GAAR,CAAY9B,CAAC,CAAC+B,IAAF,CAAOZ,MAAM,CAACa,EAAd,CAAZ,EAA+B,UAASC,GAAT,EAC/C;AACC,UAAIC,IAAI,GAAGxB,SAAS,GAAC,GAAV,GAAcuB,GAAd,GAAkB,KAA7B;AACA,aAAOhC,EAAE,CAACkC,cAAH,CAAkBD,IAAlB,EAAwBf,MAAM,CAACa,EAAP,CAAUC,GAAV,CAAxB,CAAP;AACA,KAJe,EAKhB;AACCG,MAAAA,WAAW,EAAE;AADd,KALgB,CAAjB;AASA,WAAOtC,OAAO,CAACuC,GAAR,CACN,CACCpC,EAAE,CAACkC,cAAH,CAAkBzB,SAAS,GAAC,WAA5B,EAAyCS,MAAM,CAACmB,GAAhD,CADD,EAECT,UAFD,CADM,CAAP;AAKA,GAjBK,CAAP;AAkBA","sourcesContent":["'use strict';\n\nconst Promise = require('bluebird');\nconst _       = require('lodash');\nconst fs      = Promise.promisifyAll(require('fs'));\nconst mkdirp  = Promise.promisify(require('mkdirp'));\nconst debug   = require('debug')('i18nc:fileresult');\nconst i18ncPO = require('i18nc-po');\n\n\nexports.mulitResult2POFiles = mulitResult2POFiles;\n\n/**\n * 将很多个文件解析的结果，打包成一组po文件\n * data的格式为 {filepath: <i18nc ret>}\n */\nfunction mulitResult2POFiles(data, outputDir, options)\n{\n\tif (!options) options = {};\n\tlet subScopeDatas = _.values(data);\n\tif (!subScopeDatas || !subScopeDatas.length)\n\t{\n\t\treturn Promise.resolve();\n\t}\n\tlet CodeInfoResult = subScopeDatas[0].constructor;\n\tlet result = new CodeInfoResult({subScopeDatas: subScopeDatas});\n\tlet output = i18ncPO.create(result,\n\t\t{\n\t\t\ttitle: options.poFileTitle,\n\t\t\temail: options.poFileEmail,\n\t\t\texistedTranslateFilter: options.existedTranslateFilter,\n\t\t\tonlyTheseLanguages: options.I18NHandler\n\t\t\t\t&& options.I18NHandler.data\n\t\t\t\t&& options.I18NHandler.data.onlyTheseLanguages,\n\t\t});\n\tdebug('output:%o', output);\n\n\treturn mkdirp(outputDir)\n\t\t.then(function()\n\t\t{\n\t\t\tlet poPromises = Promise.map(_.keys(output.po), function(lan)\n\t\t\t\t{\n\t\t\t\t\tlet file = outputDir+'/'+lan+'.po';\n\t\t\t\t\treturn fs.writeFileAsync(file, output.po[lan]);\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tconcurrency: 5\n\t\t\t\t});\n\n\t\t\treturn Promise.all(\n\t\t\t\t[\n\t\t\t\t\tfs.writeFileAsync(outputDir+'/lans.pot', output.pot),\n\t\t\t\t\tpoPromises\n\t\t\t\t]);\n\t\t});\n}\n"],"file":"fileresult.js"}